<!DOCTYPE html>
<html lang="pt-BR">
<head>
 <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Área do Usuário</title>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@600&family=Inter:wght@300;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=key_vertical" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
  --bg: #0e0e11;
  --glass: rgba(255, 255, 255, 0.05);
  --border: rgba(255, 255, 255, 0.1);
  --text: #f5f5f7;
  --accent: #ff4d9d;
  --accent-dark: #bd2d7d;
  --radius: 18px;
  --shadow: 0 0 40px rgba(255, 77, 157, 0.2);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(145deg, #0d0d0d, #191919);
  color: var(--text);
  padding: 3rem 1rem;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  transition: all 0.3s ease;
   display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
}

.container {
  width: 100%;
  max-width: 850px;
  padding: 2.5rem 1rem;
  border-radius: var(--radius);
  background: var(--glass);
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  margin: 1rem auto;
}

/* HEADER */
h2 {
  text-align: center;
  font-family: 'Unbounded', cursive;
  font-size: 2.5rem;
  background: linear-gradient(to right, var(--accent), #ff85b3);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 2rem;
}

/* FORMULÁRIO */
label {
  margin-top: 1rem;
  font-weight: 500;
  display: block;
}

input {
  width: 100%;
  margin-top: 0.5rem;
  padding: 0.9rem 1rem;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background-color: rgba(255, 255, 255, 0.04);
  color: var(--text);
  font-size: 1rem;
}

input:focus {
  outline: none;
  border-color: var(--accent);
}

.btn {
  width: 100%;
  margin-top: 1.5rem;
  padding: 1rem;
  border: none;
  border-radius: 50px;
  background: linear-gradient(to right, var(--accent), var(--accent-dark));
  color: white;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 20px rgba(255, 77, 157, 0.3);
}

.btn:hover {
  transform: scale(1.03);
  box-shadow: 0 6px 25px rgba(255, 77, 157, 0.5);
}

.plans-list {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-top: 1rem;
  gap: 1rem;
}

.plan-card {
  flex: 1 1 calc(33% - 1rem);
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.2rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  user-select: none;
}

.plan-card.selected {
  border-color: var(--accent);
  box-shadow: 0 0 15px rgba(255, 77, 157, 0.3);
}

.plan-card img {
  width: 60px;
  margin-bottom: 0.8rem;
}

.plan-card h4 {
  color: var(--accent);
  font-size: 1.1rem;
}

.plan-price {
  color: #fff;
  font-weight: 700;
  font-size: 1rem;
  margin-top: 0.2rem;
  opacity: 0.7;
}

.output-box {
  background: rgba(255, 255, 255, 0.07);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-top: 2rem;
  border: 1px solid var(--accent);
  color: var(--accent);
  font-size: 1.1rem;
  word-wrap: break-word;
}

/* ÁREA INFORMATIVA */
.info-box {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid var(--accent);
  padding: 1.5rem 2rem;
  border-radius: var(--radius);
  margin-top: 2rem;
  box-shadow: 0 0 20px rgba(255, 77, 157, 0.15);
  color: var(--text);
}

.info-item {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  margin-bottom: 1.2rem;
}

.info-item i {
  color: var(--accent);
  font-size: 1.2rem;
  min-width: 20px;
}

.icone-chave {
  animation: pulse 1.5s infinite;
  font-size: 1.2rem;
  margin-left: 0.4rem;
  transition: opacity 1.2s ease;
}

.icone-chave.visivel {
  opacity: 1;
}

/*Fim do estilo*/
@media (min-width: 769px) {
  .burger {
    display: none;
  }
}

@media (max-width: 400px) {
  input, .btn {
    font-size: 0.9rem;
    padding: 0.7rem 0.8rem;
  }
}

/* ANIMAÇÃO CHAVE */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

 /* Estilo para a área de requests */
  /* Área de Requests melhorada */
    .request-container {
      max-width: 900px;
      width: 100%;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 2rem;
      box-shadow: var(--shadow);
    }

    .request-container h2 {
      font-family: 'Unbounded', cursive;
      font-size: 2.4rem;
      text-align: center;
      margin-bottom: 2rem;
      background: linear-gradient(to right, var(--accent), #ff85b3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .info-box {
      background: rgba(255, 255, 255, 0.07);
      padding: 2rem;
      border-radius: var(--radius);
      border: 1px solid var(--accent);
    }

    #requests-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem;
    }

    .info-item {
      background: rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      border: 1px solid rgba(255, 77, 157, 0.25);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      max-width: 400px;
      cursor: pointer;
    }

    .info-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 25px rgba(255, 77, 157, 0.2);
    }

    .info-item h3 {
      color: var(--accent);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .info-item p {
      color: var(--text);
      font-size: 1rem;
      flex-grow: 1;
      margin: 1rem 0;
      text-align: center;
    }

    /* Modal Styles */
   /* CSS para o modal */
h1 {
      font-family: 'Unbounded', cursive;
      color: #ff4d9d;
      font-size: 2.8rem;
      text-align: center;
      margin-bottom: 3rem;
      text-shadow: 0 0 10px rgba(255, 77, 157, 0.3);
    }
    .request-section {
      margin-bottom: 3rem;
      padding: 2rem;
      border: 1px solid #ff4d9d;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 0 0 15px rgba(255, 77, 157, 0.1);
      transition: transform 0.3s ease;
    }
    .request-section:hover {
      transform: translateY(-5px);
    }
    .request-section h2 {
      font-family: 'Unbounded', cursive;
      font-size: 1.8rem;
      color: #ff4d9d;
      margin-bottom: 1rem;
    }
    .request-section p {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #e0e0e0;
    }
    .request-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .request-buttons button {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #ff4d9d, #bd2d7d);
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      flex: 1;
      transition: background 0.3s;
    }
    .request-buttons button:hover {
      background: #bd2d7d;
    }
    #modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
    }
    #modal.show {
      display: flex;
    }
    #modal-content {
      background: #1a1a1a;
      padding: 2rem;
      border-radius: 16px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 0 30px #ff4d9d;
      color: #fff;
      position: relative;
    }
    #modal-content h2 {
      font-family: 'Unbounded', cursive;
      margin-bottom: 1rem;
    }
    #code-display {
      background: #111;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ff4d9d;
    }


    @media (max-width: 768px) {
      #requests-area {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>

<body>

  <!-- Sidebar -->

 <div class="container">
    <h2>Área do Usuário</h2>

    <form onsubmit="salvar(); return false;">
      <label for="numero">WhatsApp:</label>
      <input type="tel" id="numero" placeholder="55 99 99999-9999" required />

      <label for="chave">Chave de Acesso:</label>
<div style="display: flex; gap: 0.5rem; align-items: center;">
  <input type="text" id="chave" readonly placeholder="Clique abaixo para gerar uma chave" style="flex: 1;" />
  
  <button type="button" onclick="copiarChave()" class="btn" style="padding: 0.8rem 1rem; width: auto; display: flex; align-items: center;">
    Copiar
    <span id="icone-chave" class="icone-chave"><i class="material-symbols-outlined">key_vertical</i></span>
  </button>
</div>
<button type="button" class="btn" onclick="gerarChave()" id="btGera">Gerar Chave</button>

      
      <label>Escolha um plano:</label>
      <div class="plans-list">
        <div class="plan-card" data-plano="gratuito" onclick="selecionarPlano(this)">
          <img src="./estilo/assets/Image1.png" alt="Gratuito" />
          <h4>Gratuito</h4>
          <div class="plan-price">R$ 0,00</div>
        </div>
        <div class="plan-card" data-plano="plus" onclick="selecionarPlano(this)">
          <img src="./estilo/assets/Image2.png" alt="Plus" />
          <h4>Plus</h4>
          <div class="plan-price">R$ 15,00</div>
        </div>
        <div class="plan-card" data-plano="premium" onclick="selecionarPlano(this)">
          <img src="./estilo/assets/Image3.png" alt="Premium" />
          <h4>Premium</h4>
          <div class="plan-price">R$ 30,00</div>
        </div>
      </div>

      <button type="submit" class="btn">Salvar Dados</button>
    </form>

    <!-- Área para mostrar informações do usuário -->
    <!-- Nova área com visual moderno -->
<div id="infoUsuario" class="info-box" style="display: none;">
  <div class="info-item"><i class="fas fa-phone"></i><strong>Número:</strong><span id="infoNumero"></span></div>
  <div class="info-item"><i class="fas fa-key"></i><strong>Chave de Acesso:</strong><span id="infoChave"></span></div>
  <div class="info-item"><i class="fas fa-box"></i><strong>Plano Atual:</strong><span id="planoAtual"></span></div>
  <div class="info-item"><i class="fas fa-chart-line"></i><strong>Limite de Requests:</strong><span id="limiteRequest"></span></div>
  <div class="info-item"><i class="fas fa-check-circle"></i><strong>Requests Usadas:</strong><span id="requestsRestantes"></span></div>
</div>

  </div>


 <!-- Modal -->
<h1>Área de Requisições</h1>
  <div id="requests-area"></div>
  <div id="modal">
    <div id="modal-content">
      <h2 id="modal-title">Título do Modal</h2>
      <div class="request-buttons">
        <button id="formato-fetch">Formato: Fetch</button>
        <button id="copiar">Copiar</button>
        <button id="close-modal">Fechar</button>
      </div>
      <pre id="code-display">Carregando...</pre>
    </div>
  </div>

  <script>
  let planoSelecionado = "";
  const limites = {
    gratuito: 100,
    plus: 2050,
    premium: 10000
  };



  // Gera uma chave aleatória para o usuário (se ainda não existir)
  function gerarChave() {
    const chaveAtual = document.getElementById("chave").value.trim();
    const botao = document.getElementById("btGera");
    const icone = document.getElementById("icone-chave");

    if (chaveAtual) {
      alert("Você já possui uma chave gerada.");
      botao.disabled = true;
      botao.style.backgroundColor = "#ccc";
      botao.style.cursor = "not-allowed";
      botao.innerText = "Chave já gerada!";
      return;
    }

    const chave = "key_" + Math.random().toString(36).substring(2, 10).toUpperCase();
    document.getElementById("chave").value = chave;

    // Exibir o ícone pulsando no botão
    icone.classList.add("visivel");

    botao.disabled = true;
    botao.style.backgroundColor = "#ccc";
    botao.style.cursor = "not-allowed";
    botao.innerText = "Chave gerada com sucesso!";
  }

  // Seleciona um plano e atualiza a interface
  function selecionarPlano(el) {
    document.querySelectorAll(".plan-card").forEach(p => p.classList.remove("selected"));
    el.classList.add("selected");
    planoSelecionado = el.dataset.plano;
    console.log("Plano selecionado:", planoSelecionado);
  }

  // Função para salvar os dados do usuário e solicitar código para planos pagos
async function salvar() {
  const numero = document.getElementById("numero").value.trim();
  const chave = document.getElementById("chave").value.trim();

  if (!numero || !chave || !planoSelecionado) {
    alert("Preencha todos os campos e selecione um plano.");
    return;
  }

  

  try {
    // Verifica na API se o número já existe
    const res = await fetch(`https://apiseraphina.onrender.com/api/verificar-usuario?numero=${encodeURIComponent(numero)}`);
    const data = await res.json();

    if (data.existe) {
      alert("Este número já foi cadastrado anteriormente.");
      return;
    }

    // Aqui continua o processo normal de salvar
    // Ex: fazer POST com o número, chave e planoSelecionado
    const salvarRes = await fetch("https://apiseraphina.onrender.com/api/salvar-usuario", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ numero, chave, plano: planoSelecionado })
    });

    const salvarData = await salvarRes.json();

    if (salvarRes.ok) {
      localStorage.setItem("user_token", salvarData.token || "true"); // ou use algo mais robusto
      alert("Informações salvas com sucesso.");
    } else {
       alert("Você já salvou suas informações anteriormente.");
    }

  } catch (err) {
    console.error(err);
    alert("Erro ao verificar número.");
  }
}


    // Limpa o número para apenas dígitos
    const numeroWhatsApp = numero.replace(/\D/g, "");

    // Se o plano for diferente de gratuito, força salvar como gratuito e redireciona para o WhatsApp
    let planoParaSalvar = planoSelecionado;
    let requests = limites[planoSelecionado];

    if (planoSelecionado !== "gratuito") {
      alert("Para liberar planos Plus ou Premium, entre em contato conosco pelo WhatsApp.");

      planoParaSalvar = "gratuito"; // força salvar plano gratuito
      requests = limites["gratuito"];

      // Redireciona para o WhatsApp
      const whatsappNumero = "556981219340";
      const mensagem = encodeURIComponent(`Olá, gostaria de liberar o plano ${planoSelecionado}. Meu número: ${numeroWhatsApp}`);
      window.location.href = `https://wa.me/${whatsappNumero}?text=${mensagem}`;
    }

    try {
      const res = await fetch("https://apiseraphina.onrender.com/api/save-user", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          numero: numeroWhatsApp,
          chave,
          plano: planoParaSalvar,
          limite: requests,
          token: null
        })
      });

      const data = await res.json();

      if (res.ok) {
        alert(data.message || "Usuário salvo com sucesso!");

        if (data.token) {
          localStorage.setItem("user_token", data.token);
          carregarDadosUsuario(data.token);
        } else {
          mostrarInformacoes(numeroWhatsApp, chave, planoParaSalvar, requests, 0);
        }
      } else {
        alert(data.message || "Erro ao salvar usuário.");
      }
    } catch (err) {
      console.error("Erro no fetch save-user:", err);
      alert("Erro ao salvar usuário.");
    }
    

  // Carrega os dados do usuário pelo token e preenche o formulário e área de info
  async function carregarDadosUsuario(token) {
    if (!token) return;

    try {
      const res = await fetch(`https://apiseraphina.onrender.com/api/user-info?token=${token}`);
      if (!res.ok) throw new Error("Token inválido ou usuário não encontrado");
      const data = await res.json();

      // Preencher campos do formulário
      document.getElementById("numero").value = data.numero || "";
      document.getElementById("chave").value = data.chave || "";
      planoSelecionado = data.plano || "";

      // Marcar plano selecionado
      document.querySelectorAll(".plan-card").forEach(card => {
        card.classList.toggle("selected", card.dataset.plano === planoSelecionado);
      });

      // Atualizar informações visíveis
      mostrarInformacoes(data.numero, data.chave, data.plano, data.limite, data.requisicoes);

    } catch (e) {
      console.error("Erro ao carregar dados do usuário:", e);
    }
  }

  // Copiar chave ao clicar no botão
  function copiarChave() {
    const input = document.getElementById("chave");
    if (!input.value.trim()) {
      alert("Nenhuma chave para copiar.");
      return;
    }

    input.select();
    document.execCommand("copy");
    alert("Chave copiada!");
  }

  // Atualiza a área visível com as informações do usuário
  function mostrarInformacoes(numero, chave, plano, limite, requests) {
    document.getElementById("infoNumero").innerText = ` ${numero}`;
    document.getElementById("infoChave").innerText = ` ${chave}`;
    document.getElementById("planoAtual").innerText = ` ${plano.charAt(0).toUpperCase() + plano.slice(1)}`;
    document.getElementById("limiteRequest").innerText = ` ${limite.toLocaleString()} requisições`;
    document.getElementById("requestsRestantes").innerText = ` ${requests.toLocaleString()} usadas`;
    document.getElementById("infoUsuario").style.display = "block";
  }


  // Supondo que requestsData já esteja carregado (pode ser via fetch JSON)
const requestsData = [
  {
    titulo: "Requisição - Converter YouTube em Áudio (MP3)",
    descricao: "Faz o download do áudio de um vídeo do YouTube no formato MP3.",
    case: `// Instale antes: npm install yt-search node-fetch
    //Exemplo de codigo play
const fetch = require('node-fetch');
const ytSearch = require('yt-search');
const key = "SuaKey"
case 'play': {
  if (!q) {
    return client.sendMessage(from, {
      text: \`❗ Use: \! nome da música\`,
    }, { quoted: info });
  }

  try {
    const videoResult = await ytSearch(q);
    const video = videoResult.videos[0];

    if (!video) {
      return client.sendMessage(from, {
        text: \`❌ Nenhum resultado encontrado para: "\${q}"\`,
      }, { quoted: info });
    }

    const { title, url, thumbnail, author, views, durationRaw, timestamp, uploadedAt, description } = video;
    const dataAgora = new Date();
    const envioBot = \`\${dataAgora.getDate().toString().padStart(2, '0')}/\${(dataAgora.getMonth() + 1).toString().padStart(2, '0')}/\${dataAgora.getFullYear()} às \${dataAgora.getHours().toString().padStart(2, '0')}:\${dataAgora.getMinutes().toString().padStart(2, '0')}\`;

    const legenda = ` + "`" + `
🎶 *\${title}*

📄 *Descrição Completa:*
\${description || 'Sem descrição disponível.'}

📺 *Canal:* \${author.name}
⏱ *Duração:* \${durationRaw || timestamp || 'Desconhecida'}
👁 *Visualizações:* \${views || 'Desconhecidas'}
📅 *Publicado no YouTube:* \${uploadedAt || 'Data indisponível'}
🔗 *Link:* \${url}
👤 *Solicitado por:* @\${pushname}

` + "`" + `;

    await client.sendMessage(from, {
      image: { url: thumbnail },
      caption: legenda,
    }, { quoted: info });

    const apiUrl = \`https://apiseraphina.onrender.com/api/playAudio?url=\${encodeURIComponent(url)}&apikey=\${key}\`;
    const response = await fetch(apiUrl);

    if (!response.ok || !response.headers.get('content-disposition')) {
      const error = await response.json().catch(() => ({}));
      return client.sendMessage(from, {
        text: \`❌ Erro ao processar áudio: \${error.error || 'resposta inválida'}\`,
      }, { quoted: info });
    }

    const fileBuffer = await response.buffer();
    await client.sendMessage(from, {
      audio: fileBuffer,
      mimetype: 'audio/mp4',
      ptt: false,
    }, { quoted: info });

  } catch (err) {
    console.error("Erro:", err);
    await client.sendMessage(from, {
      text: '❌ Ocorreu um erro ao processar o comando.',
    }, { quoted: info });
  }
  break;
}`,

    fetch: `function baixarAudioYoutube(apikey, videoUrl) {
  fetch(
    \`/api/playAudio?apikey=\${encodeURIComponent(apikey)}&url=\${encodeURIComponent(videoUrl)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.blob();
    })
    .then((blob) => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "audio.mp3";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    })
    .catch((err) => {
      alert('Erro ao baixar áudio');
    });
}`

  },

  {
    titulo: "Requisição - Consultar CEP",
    descricao: "Consulta informações de endereço a partir de um CEP.",
    case: `case 'consultacep':
  const cep = args[0];
  const key = "suaKey";
  if (!cep) return client.sendMessage(from, { text: 'Envie o CEP.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/consulta/cep/\${cep}?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao consultar o CEP.' });

    const data = await res.json();
    await client.sendMessage(from, {
      text: \`Endereço: \${data.rua}, \${data.cidade} - \${data.estado}\`
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function consultarCep(apikey, cep) {
  fetch(
    \`/api/consulta/cep/\${cep}?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.json();
    })
    .then((data) => {
      alert(\`Endereço: \${data.rua}, \${data.cidade} - \${data.estado}\`);
    })
    .catch((err) => {
      alert('Erro ao consultar CEP');
    });
}`

  },

  {
    titulo: "Requisição - Consultar DDD",
    descricao: "Consulta informações de cidades a partir de um DDD.",
    case: `case 'consultarddd':
  const ddd = args[0];
  const key = "suaKey";
  if (!ddd) return client.sendMessage(from, { text: 'Envie o DDD.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/consulta/ddd/\${ddd}?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao consultar o DDD.' });

    const data = await res.json();
    await client.sendMessage(from, {
      text: \`Cidades: \${data.cities.join(", ")}\`
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function consultarDdd(apikey, ddd) {
  fetch(
    \`/api/consulta/ddd/\${ddd}?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.json();
    })
    .then((data) => {
      alert(\`Cidades: \${data.cities.join(", ")}\`);
    })
    .catch((err) => {
      alert('Erro ao consultar DDD');
    });
}`

  },

  {
    titulo: "Requisição - Consultar Clima",
    descricao: "Consulta dados climáticos a partir do código ICAO de um aeroporto.",
    case: `case 'consultarclima':
  const codigoICAO = args[0];
  const key = "suaKey";
  if (!codigoICAO) return client.sendMessage(from, { text: 'Envie o código ICAO.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/consulta/clima/aeroporto/\${codigoICAO}?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao consultar o clima.' });

    const data = await res.json();
    await client.sendMessage(from, {
      text: \`Clima: \${data.condicao_desc}, Temperatura: \${data.temp}°C\`
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function consultarClima(apikey, codigoICAO) {
  fetch(
    \`/api/consulta/clima/aeroporto/\${codigoICAO}?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.json();
    })
    .then((data) => {
      alert(\`Clima: \${data.condicao_desc}, Temperatura: \${data.temp}°C\`);
    })
    .catch((err) => {
      alert('Erro ao consultar clima');
    });
}`

  },

  {
    titulo: "Requisição - Obter GIF Aleatório",
    descricao: "Obtém um GIF aleatório.",
    case: `case 'obtergif':
  const key = "suaKey";
  if (!key) return client.sendMessage(from, { text: 'API Key não fornecida.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/video-aleatorio?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao obter GIF.' });

    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    await client.sendMessage(from, {
      video: url,
      mimetype: 'video/mp4'
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function obterGif(apikey) {
  fetch(
    \`/api/video-aleatorio?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.blob();
    })
    .then((blob) => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "gif.mp4";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    })
    .catch((err) => {
      alert('Erro ao obter GIF');
    });
}`

  },

  {
    titulo: "Requisição - Obter Imagem Aleatória",
    descricao: "Obtém uma imagem aleatória.",
    case: `case 'obterimagem':
  const key = "suaKey";
  if (!key) return client.sendMessage(from, { text: 'API Key não fornecida.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/loli-aleatoria?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao obter imagem.' });

    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    await client.sendMessage(from, {
      image: url,
      mimetype: 'image/jpeg'
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function obterImagem(apikey) {
  fetch(
    \`/api/loli-aleatoria?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.blob();
    })
    .then((blob) => {
      const url = URL.createObjectURL(blob);
      const img = document.createElement("img");
      img.src = url;
      document.body.appendChild(img);
    })
    .catch((err) => {
      alert('Erro ao obter imagem');
    });
}`

  },

  {
    titulo: "Requisição - Gerar CPF Aleatório",
    descricao: "Gera um CPF aleatório.",
    case: `case 'gerarcpf':
  const key = "suaKey";
  if (!key) return client.sendMessage(from, { text: 'API Key não fornecida.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/gerar-cpf?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao gerar CPF.' });

    const data = await res.json();
    await client.sendMessage(from, {
      text: \`CPF gerado: \${data.cpf}\`
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function gerarCpf(apikey) {
  fetch(
    \`/api/gerar-cpf?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.json();
    })
    .then((data) => {
      alert(\`CPF gerado: \${data.cpf}\`);
    })
    .catch((err) => {
      alert('Erro ao gerar CPF');
    });
}`

  },

  {
    titulo: "Requisição - Obter Dados Pessoais",
    descricao: "Obtém dados pessoais aleatórios.",
    case: `case 'dadospessoais':
  const key = "suaKey";
  if (!key) return client.sendMessage(from, { text: 'API Key não fornecida.' });

  try {
    const res = await fetch(
      \`https://seusite.com/api/dados-pessoais?apikey=\${key}\`
    );
    if (!res.ok)
      return client.sendMessage(from, { text: 'Erro ao obter dados pessoais.' });

    const data = await res.json();
    await client.sendMessage(from, {
      text: \`Nome: \${data.resultado.nomeCompleto}, Idade: \${data.resultado.idade}\`
    });
  } catch (err) {
    client.sendMessage(from, { text: 'Erro ao processar a requisição.' });
  }
  break;`,

    fetch: `function obterDadosPessoais(apikey) {
  fetch(
    \`/api/dados-pessoais?apikey=\${encodeURIComponent(apikey)}\`
  )
    .then((res) => {
      if (!res.ok) {
        return res.json().then((err) => {
          throw new Error(err.error || "Erro desconhecido");
        });
      }
      return res.json();
    })
    .then((data) => {
      alert(\`Nome: \${data.resultado.nomeCompleto}, Idade: \${data.resultado.idade}\`);
    })
    .catch((err) => {
      alert('Erro ao obter dados pessoais');
    });
}`

  }
];
 
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const codeDisplay = document.getElementById('code-display');
    let modoAtual = 'fetch';

    function abrirModal(index) {
      const req = requestsData[index];
      modalTitle.innerText = req.titulo;
      codeDisplay.innerText = req[modoAtual];
      modal.classList.add('show');
    }

    function renderRequests() {
      const container = document.getElementById('requests-area');
      container.innerHTML = '';
      requestsData.forEach((req, index) => {
        const section = document.createElement('div');
        section.className = 'request-section';
        section.innerHTML = `<h2>${req.titulo}</h2><p>${req.descricao}</p>`;

        const btns = document.createElement('div');
        btns.className = 'request-buttons';
        const verBtn = document.createElement('button');
        verBtn.innerText = 'Ver Código';
        verBtn.onclick = () => abrirModal(index);
        btns.appendChild(verBtn);

        section.appendChild(btns);
        container.appendChild(section);
      });
    }

    renderRequests();

    document.getElementById('formato-fetch').addEventListener('click', () => {
      modoAtual = modoAtual === 'fetch' ? 'case' : 'fetch';
      const title = modalTitle.innerText;
      const req = requestsData.find(r => r.titulo === title);
      codeDisplay.innerText = req[modoAtual];
      document.getElementById('formato-fetch').innerText = `Formato: ${modoAtual === 'fetch' ? 'Fetch' : 'Case'}`;
    });

    document.getElementById('copiar').addEventListener('click', () => {
      const texto = codeDisplay.innerText;
      navigator.clipboard.writeText(texto).then(() => alert('Copiado com sucesso!'));
    });

    document.getElementById('close-modal').addEventListener('click', () => {
      modal.classList.remove('show');
    });

    modal.addEventListener('click', e => {
      if (e.target === modal) {
        modal.classList.remove('show');
      }
    });

  window.addEventListener('load', () => {

    const token = localStorage.getItem("user_token");
    if (token) {
      carregarDadosUsuario(token);
    }

    // Desativa o botão de gerar chave se já existe uma
    const chaveExistente = document.getElementById("chave").value.trim();
    if (chaveExistente) {
      document.getElementById("icone-chave").classList.add("visivel");
      const botao = document.getElementById("btGera");
      botao.disabled = true;
      botao.style.backgroundColor = "#ccc";
      botao.style.cursor = "not-allowed";
      botao.innerText = "Chave já gerada!";
    }
  });
  </script>

</body>
</html>
